#!/bin/bash

set -e

if [ -f .Dockerfile.sha1 ]; then
    DF_SHA=$(cat .Dockerfile.sha1)
else
    DF_SHA=''
fi

if docker images | grep debirf-builder > /dev/null && [ "$DF_SHA" == "$(shasum Dockerfile | cut -d ' ' -f 1)" ]; then
    echo '--> Dockerfile container exists and is unmodified from last build, skipping'
else
    echo '--> Building docker container'
    docker build -t debirf-builder .
    shasum Dockerfile | cut -d ' ' -f 1 > .Dockerfile.sha1
fi
